<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>é»‘åå•ç®¡ç†</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #1976d2; }
    form { display: flex; gap: 10px; margin: 20px 0; }
    input, button { padding: 8px 12px; font-size: 16px; }
    button.add { background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button.del { background: #f44336; color: white; border: none; border-radius: 4px; padding: 4px 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background: #e3f2fd; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸŒ é»‘åå•ç®¡ç†</h2>
    <p>æ·»åŠ åŸŸåï¼ˆå¦‚ <code>qq.com</code>ï¼‰ï¼Œæ”¯æŒé€šé…ï¼š<code>*.qq.com</code> ä¼šè‡ªåŠ¨åŒ¹é…å­åŸŸ</p>
    
    <form id="addForm">
      <input type="text" id="domain" placeholder="åŸŸåï¼ˆå¦‚ï¼šqq.comï¼‰" required>
      <input type="text" id="reason" placeholder="åŸå› ï¼ˆå¯é€‰ï¼‰">
      <button type="submit" class="add">â• æ·»åŠ </button>
    </form>

    <table id="list">
      <thead>
        <tr><th>ID</th><th>åŸŸå</th><th>åŸå› </th><th>æ·»åŠ æ—¶é—´</th><th>æ“ä½œ</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const tbody = document.querySelector('#list tbody');

    // åŠ è½½é»‘åå•
    function loadList() {
      fetch('/api/blacklist')
        .then(r => r.json())
        .then(data => {
          tbody.innerHTML = '';
          data.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${item.id}</td>
              <td><strong>${item.domain}</strong></td>
              <td>${item.reason || 'â€”'}</td>
              <td>${new Date(item.created_at).toLocaleString('zh-CN')}</td>
              <td><button class="del" onclick="del(${item.id})">ğŸ—‘ï¸ åˆ é™¤</button></td>
            `;
            tbody.appendChild(tr);
          });
        });
    }

    document.getElementById('addForm').onsubmit = async (e) => {
      e.preventDefault();
      const domain = document.getElementById('domain').value.trim();
      const reason = document.getElementById('reason').value.trim();
      
      const res = await fetch('/api/blacklist/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ domain, reason })
      });
      const data = await res.json();
      if (data.ok) {
        alert('âœ… æ·»åŠ æˆåŠŸï¼');
        document.getElementById('addForm').reset();
        loadList();
      } else {
        alert('âŒ å¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
      }
    };

    window.del = async (id) => {
      if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
      await fetch(`/api/blacklist/${id}`, { method: 'DELETE' });
      loadList();
    };

    loadList();
  </script>
</body>
</html>