<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æœºæˆ¿è¡Œä¸ºç›‘æ§</title>
  <style>
    body { font-family: sans-serif; padding: 15px; background: #f0f8ff; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid #ccc; }
    tr.blacklisted { background: #ffebee; }
    .time { color: #666; font-size: 0.9em; }
    .bad { color: #d32f2f; font-weight: bold; }
    .good { color: #388e3c; font-weight: bold; }
    #status { font-size: 0.9em; color: #666; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>ğŸ« æœºæˆ¿è¡Œä¸ºç›‘æ§ï¼ˆè‡ªåŠ¨åˆ·æ–°ï¼š7ç§’ï¼‰</h1>
  <div id="status">æ­£åœ¨åŠ è½½...</div>
  
  <table>
    <thead>
      <tr>
        <th>æ—¶é—´</th>
        <th>å­¦ç”ŸID</th>
        <th>ç½‘å€</th>
        <th>æ ‡é¢˜</th>
        <th>çŠ¶æ€</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    const tbody = document.getElementById('tbody');
    const status = document.getElementById('status');

    function truncateUrl(url) {
      return url.length > 60 ? url.substring(0, 57) + '...' : url;
    }

    function loadLatest() {
      status.textContent = `ğŸ”„ åˆ·æ–°ä¸­...ï¼ˆ${new Date().toLocaleTimeString()}ï¼‰`;
      fetch('/api/latest?limit=30')
        .then(r => r.json())
        .then(rows => {
          tbody.innerHTML = '';
          rows.forEach(row => {
            const time = new Date(row.timestamp).toLocaleString('zh-CN');
            const tr = document.createElement('tr');
            if (row.blacklisted) tr.className = 'blacklisted';
            
            tr.innerHTML = `
              <td class="time">${time}</td>
              <td>${row.student_id}</td>
              <td><a href="${row.url}" target="_blank" title="${row.url}">${truncateUrl(row.url)}</a></td>
              <td>${row.title || 'â€”'}</td>
              <td>${row.blacklisted ? '<span class="bad">âš ï¸ é»‘åå•</span>' : '<span class="good">âœ… æ­£å¸¸</span>'}</td>
            `;
            tbody.appendChild(tr);
          });
          status.textContent = `âœ… æœ€åæ›´æ–°ï¼š${new Date().toLocaleTimeString()}`;
        })
        .catch(e => status.textContent = `âŒ åŠ è½½å¤±è´¥ï¼š${e.message}`);
    }

    // é¦–æ¬¡åŠ è½½
    loadLatest();
    // æ¯ 7 ç§’åˆ·æ–°
    setInterval(loadLatest, 7000);
  </script>
</body>
</html>